<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>심심해</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
        background: linear-gradient(135deg, #f8e8ee, #e8f0ff);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow-x: hidden;
      }

      /* 봉투 */
      .envelope {
        width: 320px;
        height: 200px;
        position: relative;
        cursor: pointer;
        transition: transform 0.3s ease;
      }

      .envelope:hover {
        transform: scale(1.03);
      }

      .envelope-body {
        width: 100%;
        height: 100%;
        background: url("envelope_body.png") no-repeat center / 100% 100%;
        position: absolute;
        bottom: 0;
        left: 0;
        z-index: 2;
      }

      .envelope-body2 {
        width: 100%;
        height: 100%;
        background: url("envelope_body_2.png") no-repeat center / 100% 100%;
        position: absolute;
        bottom: 0;
        left: 0;
        z-index: 5;
        opacity: 0;
        transition: opacity 0s ease;
      }

      .sticker {
        position: absolute;
        top: 88px; /* 뚜껑 아래 위치 */
        left: 50%;
        width: 34px;
        height: 34px;
        background: url("sticker.png") no-repeat center / contain;
        transform: translateX(-50%);
        z-index: 6; /* 봉투 몸체 위, 뚜껑 아래 */
        pointer-events: none; /* 클릭 방해 방지 */
      }

      .envelope-flap {
        width: 100%;
        height: 100%;
        background: url("envelope_flap.png") no-repeat center / 100% 100%;
        position: absolute;
        top: 0;
        left: 0;
        transform-origin: 50% 0%; /* 플랩 하단 중앙 기준 */
        transition: transform 0.5s ease;
        z-index: 3;
      }

      /* 편지 */
      .letter {
        position: absolute;
        bottom: 50px;
        left: 10px;
        width: 100%;
        height: 100%;
        background: url("letter_paper.png") no-repeat center / cover;
        border-radius: 12px;
        padding: 40px 30px;
        box-sizing: border-box;
        transform: translateY(50px);
        opacity: 0;
        transition:
          transform 1s ease,
          opacity 0.3s ease;
        z-index: 4;
        overflow-y: auto;
      }

      /* 쪽지 */
      .note {
        position: absolute;
        bottom: 20px;
        right: 50px; /* 완전히 숨김 */
        width: 140px;
        height: 120px;

        background: url("secret_letter.png") no-repeat center / contain;
        background-color: transparent;

        border-radius: 6px;
        box-sizing: border-box;
        z-index: 1;
        cursor: pointer;

        transform: rotate(-8deg);
        transition:
          right 0.6s ease,
          transform 0.4s ease;
      }

      /* 열린 상태 */
      .open-flap .envelope-flap {
        transform: rotateX(180deg);
      }

      .open-flap .letter {
        opacity: 1;
      }

      .show-letter .letter {
        transform: translateY(-100px);
      }

      .open-flap .envelope-body2 {
        opacity: 1;
      }

      .show-letter .note {
        right: -50px; /* 살짝 보임 */
        animation: wiggle 1.8s ease-in-out infinite;
      }

      .note.open {
        right: -100px;
        transform: rotate(0deg);
        animation: none;
        z-index: 6; /* 앞으로 */
      }

      @keyframes wiggle {
        0%,
        100% {
          transform: rotate(-8deg) translateX(0);
        }
        50% {
          transform: rotate(-6deg) translateX(2px);
        }
      }
    </style>
  </head>
  <body>
    <div id="envelope" class="envelope">
      <div class="sticker"></div>
      <div class="envelope-flap"></div>
      <div class="envelope-body"></div>
      <div class="envelope-body2"></div>
      <div class="letter"></div>
      <div class="note"></div>
    </div>

    <script>
      const envelope = document.getElementById("envelope");
      const letter = document.querySelector(".letter");
      const note = document.querySelector(".note");

      // 0: 닫힘, 1: 뚜껑 열림, 2: 편지 나옴
      let step = 0;

      /* =====================
          봉투 클릭 (단계 제어)
        ====================== */
      envelope.addEventListener("click", (e) => {
        if (step === 0) {
          envelope.classList.add("open-flap");
          step = 1;
          vibrate(20);
        } else if (step === 1) {
          envelope.classList.add("show-letter");
          step = 2;
          vibrate(30);
        } else {
          envelope.classList.remove("show-letter", "open-flap");
          note.classList.remove("open");
          step = 0;
        }
      });

      note.addEventListener("click", (e) => {
        e.stopPropagation(); // 봉투 클릭 방지
        note.classList.toggle("open");
        vibrate([20, 30, 20]);
      });

      function vibrate(pattern) {
        if (navigator.vibrate) {
          navigator.vibrate(pattern);
        }
      }
    </script>
  </body>
</html>
